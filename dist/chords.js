var chords={},_chords=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],_chordsFlat=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];function transposition(r,e,n){var s=0,a='<span class="chords-highlighted">',t="</span>",i=[];return r.forEach((function(r,l){var c=r;r=r.replace(/m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/))? *$/,"");var h=(i=_chords.indexOf(r)<0?_chordsFlat:_chords).indexOf(r);if(n<0)if(h+n<0)var d=i[(i.length+h+n)%i.length];else d=i[(h+n)%i.length];else d=i[(h+n)%i.length];var g=d.length-r.length;e=e.slice(0,l+s)+a+d+e.slice(l+s+r.length,l+s+c.length)+t+e.slice(l+s+c.length),s+=40+g})),e}function transposition_new(r,e,n,s){var a=0,t='<span class="chords-highlighted">',i="</span>",l=[];return r.forEach((function(r,c){var h=r;r=r.replace(/m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/))? *$/,""),l="flat"===s?_chordsFlat:_chords;var d=null;if(d=_chordsFlat.indexOf(r)>-1?_chordsFlat.indexOf(r):_chords.indexOf(r),n<0)if(d+n<0)var g=l[(l.length+d+n)%l.length];else g=l[(d+n)%l.length];else g=l[(d+n)%l.length];var o=g.length-r.length;e=e.slice(0,c+a)+t+g+e.slice(c+a+r.length,c+a+h.length)+i+e.slice(c+a+h.length),a+=40+o})),e}function array2string(r){var e="";return r.forEach((function(r,n){e+=r+"\n"})),e}function findChords(r){if(/^\s*[eBGDAE]\|/.test(r))return[];var e,n;r=r.replace(/\|/g," ").replace(/\t/g," ").replace(/\-/g," ").replace(/\//g," ").replace(/\(/g," ").replace(/\)/g," ").replace(/\,/g," ").replace(/\s/g," ").replace(/[\[\]']+/g," ");return String(r).match(/^ *[A-Ga-g](#|b|&)?m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/) *[A-G](#|b)?)?( +[A-Ga-g](#|b|&)?m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/) *[A-G](#|b|&)?)? *)* *$/)?(e=r.search(/[A-Ga-g](#|b|&)?m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/) *[A-G](#|b|&)?)? *$/),(n=findChords(r.substr(0,e-1)))[e]=r.substr(e).trim(),n):[]}function replaceWithTags(r,e){var n=0,s='<span class="chords-highlighted">',a="</span>";return r.forEach((function(r,t){e=e.slice(0,t+n)+s+e.slice(t+n,t+n+r.length)+a+e.slice(t+n+r.length),n+=40})),e}chords.parse=function(r){for(var e=r.split(/\r\n|\r|\n/g),n=0;n<e.length;n++)e[n]=replaceWithTags(findChords(e[n]),e[n]);return array2string(e)},chords.shiftScale=function(r,e,n,s){e=e.replace(/m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/))? *$/,"").replace(" ","");for(var a=("b"===n.substr(1,1)?_chordsFlat.indexOf(n):_chords.indexOf(n))-(_chords.indexOf(e)>-1?_chords.indexOf(e):_chordsFlat.indexOf(e)),t=r.split(/\r\n|\r|\n/g),i=0;i<t.length;i++)t[i]=transposition_new(findChords(t[i]),t[i],a,s);return array2string(t)},chords.shiftScaleBy=function(r,e){for(var n=e,s=r.split(/\r\n|\r|\n/g),a=0;a<s.length;a++)s[a]=transposition(findChords(s[a]),s[a],n);return array2string(s)};
