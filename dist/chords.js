var chords={},_chords=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],_chordsFlat=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];function transposition(r,n,e){var a=0,s='<span class="chords-highlighted">',t="</span>",i=[];return r.forEach((function(r,l){var h=r;r=r.replace(/m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/))? *$/,"");var c=(i=_chords.indexOf(r)<0?_chordsFlat:_chords).indexOf(r);if(e<0){var d=(c+e)%i.length;d<0&&(d=(d+i.length)%i.length);var g=i[d]}else g=i[(c+e)%i.length];g.length,r.length;n=n.slice(0,l+a)+s+g+n.slice(l+a+r.length,l+a+h.length)+t+n.slice(l+a+h.length),a+=g.length-r.length+40})),n}function transposition_new(r,n,e,a){var s=0,t='<span class="chords-highlighted">',i="</span>",l=[];return r.forEach((function(r,h){var c=r;r=r.replace(/m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/))? *$/,""),l="flat"===a?_chordsFlat:_chords;var d=null;if(d=_chordsFlat.indexOf(r)>-1?_chordsFlat.indexOf(r):_chords.indexOf(r),e<0)if(d+e<0)var g=l[(l.length+d+e)%l.length];else g=l[(d+e)%l.length];else g=l[(d+e)%l.length];var o=g.length-r.length;n=n.slice(0,h+s)+t+g+n.slice(h+s+r.length,h+s+c.length)+i+n.slice(h+s+c.length),s+=40+o})),n}function array2string(r){var n="";return r.forEach((function(r,e){n+=r+"\n"})),n}function findChords(r){if(/^\s*[eBGDAE]\|/.test(r))return[];var n,e;r=r.replace(/\|/g," ").replace(/\t/g," ").replace(/\-/g," ").replace(/\//g," ").replace(/\(/g," ").replace(/\)/g," ").replace(/\,/g," ").replace(/\s/g," ").replace(/[\[\]']+/g," ");return String(r).match(/^ *[A-Ga-g](#|b|&)?m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/) *[A-G](#|b)?)?( +[A-Ga-g](#|b|&)?m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/) *[A-G](#|b|&)?)? *)* *$/)?(n=r.search(/[A-Ga-g](#|b|&)?m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/) *[A-G](#|b|&)?)? *$/),(e=findChords(r.substr(0,n-1)))[n]=r.substr(n).trim(),e):[]}function replaceWithTags(r,n){var e=0,a='<span class="chords-highlighted">',s="</span>";return r.forEach((function(r,t){n=n.slice(0,t+e)+a+n.slice(t+e,t+e+r.length)+s+n.slice(t+e+r.length),e+=40})),n}chords.parse=function(r){for(var n=r.split(/\r\n|\r|\n/g),e=0;e<n.length;e++)n[e]=replaceWithTags(findChords(n[e]),n[e]);return array2string(n)},chords.shiftScale=function(r,n,e,a){n=n.replace(/m?\+?(sus|add|maj|dim|aug)?[0-9]?( *(-|\/))? *$/,"").replace(" ","");for(var s=("b"===e.substr(1,1)?_chordsFlat.indexOf(e):_chords.indexOf(e))-(_chords.indexOf(n)>-1?_chords.indexOf(n):_chordsFlat.indexOf(n)),t=r.split(/\r\n|\r|\n/g),i=0;i<t.length;i++)t[i]=transposition_new(findChords(t[i]),t[i],s,a);return array2string(t)},chords.shiftScaleBy=function(r,n){for(var e=n,a=r.split(/\r\n|\r|\n/g),s=0;s<a.length;s++)a[s]=transposition(findChords(a[s]),a[s],e);return array2string(a)};
