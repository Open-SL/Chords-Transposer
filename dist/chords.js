function transposition(r,s,n){var a=0,e=[];return r.forEach(function(r,t){var h=r;r=r.replace(/m?(sus|add|maj)?[0-9]?( *(-|\/))? *$/,""),e=_chords.indexOf(r)<0?_chordsFlat:_chords;var i=e.indexOf(r);if(n<0)if(i+n<0)var c=e[(e.length+i+n)%e.length];else var c=e[(i+n)%e.length];else var c=e[(i+n)%e.length];var l=c.length-r.length;s=s.slice(0,t+a)+'<span class="chords-highlighted">'+c+s.slice(t+a+r.length,t+a+h.length)+"</span>"+s.slice(t+a+h.length),a+='<span class="chords-highlighted">'.length+"</span>".length+l}),s}function array2string(r){var s="";return r.forEach(function(r,n){s+=r+"\n"}),s}function findChords(r){var s,n,r=r.replace(/\|/g," ").replace(/\t/g," ").replace(/\-/g," ").replace(/\//g," ").replace(/[\[\]']+/g," "),a=/^ *[A-Ga-g](#|b|&)?m?(sus|add|maj)?[0-9]?( *(-|\/) *[A-G](#|b)?)?( +[A-Ga-g](#|b|&)?m?(sus|add|maj)?[0-9]?( *(-|\/) *[A-G](#|b|&)?)? *)* *$/,e=/[A-Ga-g](#|b|&)?m?(sus|add|maj)?[0-9]?( *(-|\/) *[A-G](#|b|&)?)? *$/;return String(r).match(a)?(s=r.search(e),n=findChords(r.substr(0,s-1)),n[s]=r.substr(s).trim(),n):[]}function replaceWithTags(r,s){var n=0;return r.forEach(function(r,a){s=s.slice(0,a+n)+'<span class="chords-highlighted">'+s.slice(a+n,a+n+r.length)+"</span>"+s.slice(a+n+r.length),n+='<span class="chords-highlighted">'.length+"</span>".length}),s}var chords={},_chords=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],_chordsFlat=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];chords.parse=function(r){for(var s=r.split(/\r\n|\r|\n/g),n=0;n<s.length;n++)s[n]=replaceWithTags(findChords(s[n]),s[n]);return array2string(s)},chords.shiftScale=function(r,s,n){for(var a=_chords.indexOf(s),e=_chords.indexOf(n),t=e-a,h=r.split(/\r\n|\r|\n/g),i=0;i<h.length;i++)h[i]=transposition(findChords(h[i]),h[i],t);return array2string(h)},chords.shiftScaleBy=function(r,s){for(var n=s,a=r.split(/\r\n|\r|\n/g),e=0;e<a.length;e++)a[e]=transposition(findChords(a[e]),a[e],n);return array2string(a)},exports.parse=chords.parse,exports.shiftScale=chords.shiftScale,exports.shiftScaleBy=chords.shiftScaleBy;